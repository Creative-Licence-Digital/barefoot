<!DOCTYPE html>

<html>
<head>
  <title>Barefoot</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1>Barefoot</h1>

          
        

        
      </div>

      
        
        <h2>Module dependencies</h2>

        
      
        
        
        
          <div class='highlight'><pre>lateral = require <span class="string">'lateral'</span></pre></div>
        
      
        
        <h2>Let&#39;s get started</h2>

        
      
        
        <p>We declare an object to contain all the methods we want to export from this  module</p>

        
          <div class='highlight'><pre>methods = {}</pre></div>
        
      
        
        <p><strong>toDictionary</strong> </p>
<p>Transform an array of object into a dictionary based on the property passed as a second param</p>

        
          <div class='highlight'><pre>methods.<span class="function"><span class="title">toDictionary</span></span> = (array, prop) -&gt;
  dictionary = {}
  array.forEach (elt) -&gt; 
    dictionary[elt[prop]] = elt <span class="keyword">if</span> elt? <span class="keyword">and</span> elt[prop]?
  <span class="keyword">return</span> dictionary</pre></div>
        
      
        
        <p><strong>amap</strong></p>
<p>Asynchronous map 
Use the awesome <strong>lateral</strong> module to do the job</p>

        
          <div class='highlight'><pre>methods.<span class="function"><span class="title">amap</span></span> = (func, nbProcesses) -&gt;
  nbProcesses ?= <span class="number">1</span>
  (array, done) -&gt;
    results = []
    errors = <span class="literal">null</span>
    unit = lateral.create (complete, item) -&gt;
      func item, (err, res) -&gt;
        <span class="keyword">if</span> err?
          errors ?= []
          errors.push(err)
          results.push <span class="literal">null</span>
        <span class="keyword">else</span>
          results.push res
        complete()
    , nbProcesses

    unit.add(array).<span class="keyword">when</span> () -&gt;
      done errors, results</pre></div>
        
      
        
        <p><strong>chain</strong></p>
<p>Chain aynschronous methods with signature (params, done) -&gt; done(err, result)
Stop if one of the method has an error in the callback</p>

        
          <div class='highlight'><pre>global.Array.prototype.<span class="function"><span class="title">chain</span></span> = (params, done, err) -&gt;
  <span class="keyword">if</span> @.length == <span class="number">0</span>
    done err, params
  <span class="keyword">else</span>
    @[<span class="number">0</span>] params, (err, res) =&gt;
      <span class="keyword">if</span> err?
        done err, res
      <span class="keyword">else</span>
        @.slice(<span class="number">1</span>, @.length).chain(res, done, err)</pre></div>
        
      
        
        <h2>Export public methods</h2>

        
      
        
        
        
          <div class='highlight'><pre>module.exports = methods</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
